---
import type { BlockObjectResponse } from "@notionhq/client/build/src/api-endpoints";
import { getBlockChildren } from "../../../lib/notion/caches";
import BulletedListItemBlock from "./BulletedListItemBlock.astro";
import CalloutBlock from "./CalloutBlock.astro";
import CodeBlock from "./CodeBlock.astro";
import Column from "./Column.astro";
import ColumnList from "./ColumnList.astro";
import DefaultBlock from "./DefaultBlock.astro";
import DividerBlock from "./DividerBlock.astro";
import Heading1Block from "./Heading1Block.astro";
import Heading2Block from "./Heading2Block.astro";
import Heading3Block from "./Heading3Block.astro";
import ImageBlock from "./ImageBlock.astro";
import NumberedListItemBlock from "./NumberedListItemBlock.astro";
import ParagraphBlock from "./ParagraphBlock.astro";
import QuoteBlock from "./QuoteBlock.astro";
import TableBlock from "./TableBlock.astro";
import TableRowBlock from "./TableRowBlock.astro";
import TodoBlock from "./TodoBlock.astro";
import ToggleBlock from "./ToggleBlock.astro";
import type { NotionOverrideableProps } from "./types";
import NotionRenderer from "./NotionRenderer.astro";

export interface Props extends NotionOverrideableProps {
  block: BlockObjectResponse;
}

const { block, overrides } = Astro.props;

const children = block.has_children
  ? await getBlockChildren(block.id)
  : undefined;

let Component: any;
switch (block.type) {
  case "paragraph":
    Component = ParagraphBlock;
    break;
  case "heading_1":
    Component = Heading1Block;
    break;
  case "heading_2":
    Component = Heading2Block;
    break;
  case "heading_3":
    Component = Heading3Block;
    break;
  case "callout":
    Component = CalloutBlock;
    break;
  case "code":
    Component = CodeBlock;
    break;
  case "toggle":
    Component = ToggleBlock;
    break;
  case "bulleted_list_item":
    Component = BulletedListItemBlock;
    break;
  case "numbered_list_item":
    Component = NumberedListItemBlock;
    break;
  case "image":
    Component = ImageBlock;
    break;
  case "quote":
    Component = QuoteBlock;
    break;
  case "divider":
    Component = DividerBlock;
    break;
  case "column_list":
    Component = ColumnList;
    break;
  case "column":
    Component = Column;
    break;
  case "to_do":
    Component = TodoBlock;
    break;
  case "table":
    Component = TableBlock;
    break;
  case "table_row":
    Component = TableRowBlock;
    break;
  case "template":
  case "synced_block":
  case "child_page":
  case "child_database":
  case "equation":
  case "breadcrumb":
  case "table_of_contents":
  case "link_to_page":
  case "embed":
  case "bookmark":
  case "video":
  case "pdf":
  case "file":
  case "audio":
  case "link_preview":
  case "unsupported":
  default:
    Component = DefaultBlock;
}

if (overrides[block.type]) {
  Component = overrides[block.type];
}
---

<Component block={block} overrides={overrides}>
  {
    children ? (
      <NotionRenderer blocks={children} overrides={overrides} />
    ) : undefined
  }
</Component>
