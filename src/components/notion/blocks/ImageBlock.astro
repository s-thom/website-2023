---
import type { ImageBlockObjectResponse } from "@notionhq/client/build/src/api-endpoints";
import { richTextToUnformattedString } from "../../../lib/notion";
import ExternalImage from "../../ExternalImage/ExternalImage.astro";
import RichText from "../common/RichText.astro";
import DevOnly from "../../DevOnly.astro";

export interface Props {
  block: ImageBlockObjectResponse;
}

const { block } = Astro.props;

const GENERATE_IMAGE_WIDTHS = [1920, 720, 360];

let url: string | undefined;
switch (block.image.type) {
  case "external":
    url = block.image.external.url;
    break;
  case "file":
    url = block.image.file.url;
    break;
  default:
    url = undefined;
}

const captionPlain = richTextToUnformattedString(block.image.caption);
---

{
  url ? (
    <figure>
      <ExternalImage
        src={url}
        alt={captionPlain}
        id={block.id}
        widths={GENERATE_IMAGE_WIDTHS}
      />
      <figcaption>
        <RichText components={block.image.caption} />
      </figcaption>
    </figure>
  ) : (
    <DevOnly>
      image block {block.id} has image type {block.image.type}
    </DevOnly>
  )
}
