---
import BlogListPageItem from "../../components/notion/blog/BlogListPageItem.astro";
import NotionPageLayout from "../../layouts/NotionPageLayout.astro";
import { BLOG_PAGE_ID } from "../../lib/constants";
import { getFilteredBlogItems } from "../../lib/notion/blog";
import { getPage } from "../../lib/notion/caches";

const page = await getPage(BLOG_PAGE_ID);

const pages = await getFilteredBlogItems({
  allowUnpublished: import.meta.env.DEV,
  allowUnlisted: false,
});
---

<NotionPageLayout
  page={page}
  meta={{
    title: "Blog",
    url: "/blog",
    rssUrl: "/blog/feed.xml",
    header: { seed: page.id, maskType: "waves", iconType: "none" },
  }}
  breadcrumbs={[
    { name: "Home", url: "/" },
    { name: "Blog", url: "/blog" },
  ]}
>
  <ul class="page-list small-bleed">
    {
      pages.map((childPage) => (
        <li>
          <BlogListPageItem page={childPage} />
        </li>
      ))
    }
  </ul>
</NotionPageLayout>

<style>
  .page-list {
    display: grid;
    gap: var(--spacing);
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
  }

  @media (min-width: 900px) {
    .page-list {
      grid-template-columns: 1fr 1fr;
    }
  }
</style>
