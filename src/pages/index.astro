---
import type { DatabaseObjectResponse } from "@notionhq/client/build/src/api-endpoints";
import { Image } from "astro:assets";
import { GithubIcon, LinkedinIcon, MailIcon } from "lucide-react";
import PageLayout from "../layouts/PageLayout.astro";
import { ACTIVE_PROJECTS_COLLECTION_ID } from "../lib/constants";
import { getFilter } from "../lib/notion/blog";
import { queryDatabase } from "../lib/notion/caches";
import profile2023 from "../resources/profile-2023.jpg";
import ProjectsItem from "../components/notion/overrides/projects/ProjectsItem.astro";
import SiteFooter from "../components/SiteFooter.astro";

const NUM_PROJECTS_TO_SHOW = 3;

const activeProjectItems = (await queryDatabase(
  ACTIVE_PROJECTS_COLLECTION_ID,
  getFilter({ allowUnlisted: import.meta.env.DEV }),
  [
    {
      property: "Sorting",
      direction: "descending",
    },
  ],
)) as DatabaseObjectResponse[];
const projectItemsToShow = activeProjectItems.slice(0, NUM_PROJECTS_TO_SHOW);
---

<PageLayout id="home" meta={{ title: "Stuart Thomson", url: "/" }}>
  <div>
    <Image
      src={profile2023}
      alt="Stuart Thomson smiling, with water and hills in the background"
      class="profile-photo"
      densities={[1, 1.5, 2]}
      loading="eager"
    />
    <h1>Stuart Thomson</h1>
    <h2>Software Developer | Human Being</h2>
  </div>
  <div>
    <a href="/about">About me</a>
    <a href="/blog">Blog</a>
    <a href="/projects">Projects</a>
  </div>
  <div>
    <a
      href="https://github.com/s-thom"
      aria-label="GitHub"
      rel="nofollow noopener noreferrer"
      target="_blank"
    >
      <GithubIcon />
    </a>
    <a
      href="mailto:me@sthom.kiwi"
      aria-label="Email"
      rel="nofollow noopener noreferrer"
      target="_blank"
    >
      <MailIcon />
    </a>
    <a
      href="https://www.linkedin.com/in/s-thom/"
      aria-label="LinkedIn"
      rel="nofollow noopener noreferrer"
      target="_blank"
    >
      <LinkedinIcon />
    </a>
  </div>
  <div>
    {
      projectItemsToShow.map((item) => (
        <ProjectsItem page={item} overrides={{}} showImage showTitle />
      ))
    }
    <a href="/projects">See more...</a>
  </div>
  <SiteFooter slot="site-footer" />
</PageLayout>
